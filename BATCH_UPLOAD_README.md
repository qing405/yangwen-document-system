# 文档批量上传功能说明文档

## 功能概述

本次更新为文档管理页面添加了强大的批量文档上传功能，支持多种文档类型、上传进度显示、文件预览、拖拽排序等高级特性。这是专门为文档管理设计的批量上传功能，与表单填写页面的文件上传功能不同。

## 主要特性

### 1. 智能文档选择
- **批量选择**：支持一次选择多个文档（最多20个）
- **文档类型限制**：支持PDF、Word、Excel、PPT、图片等常用文档格式
- **文件大小验证**：自动检查文件大小是否符合要求
- **文件数量控制**：可配置每个批次的最大文件数量

### 2. 上传进度管理
- **实时进度条**：显示每个文档的上传进度
- **状态指示器**：清晰显示文档的上传状态（等待、上传中、完成、失败）
- **批量上传**：支持同时上传多个文档
- **错误处理**：上传失败时显示错误信息并提供重试选项

### 3. 文档预览功能
- **图片预览**：支持图片文档的直接预览
- **文档信息**：显示详细的文档信息（名称、大小、类型、状态等）
- **文档图标**：根据文档类型显示不同的图标

### 4. 拖拽排序
- **拖拽手柄**：每个文档项都有拖拽手柄
- **实时排序**：支持拖拽调整文档顺序
- **视觉反馈**：拖拽过程中提供清晰的视觉反馈

### 5. 文档管理
- **删除文档**：支持删除已选择的文档
- **重试上传**：上传失败的文档可以重新上传
- **文档验证**：自动验证文档格式和大小

## 配置选项

### 文档上传配置

```javascript
{
  // 支持的文件类型
  supportedExtensions: ['pdf', 'doc', 'docx', 'xls', 'xlsx', 'ppt', 'pptx', 'txt', 'jpg', 'jpeg', 'png', 'gif'],
  
  // 最大文件数量
  maxFiles: 20,
  
  // 单个文件大小限制（字节）
  maxFileSize: 100 * 1024 * 1024, // 100MB
  
  // 支持的文件类型
  fileTypes: ['file', 'image']
}
```

### 预设配置

系统支持以下文档格式：

#### 办公文档
- 支持格式：pdf, doc, docx, xls, xlsx, ppt, pptx, txt
- 大小限制：100MB
- 数量限制：20个

#### 图片文档
- 支持格式：jpg, jpeg, png, gif
- 大小限制：50MB
- 数量限制：20个

## 使用方法

### 1. 选择文档
1. 点击"批量上传"按钮
2. 在弹出的文件选择器中选择一个或多个文档
3. 系统自动验证文档类型和大小
4. 验证通过的文档显示在列表中

### 2. 管理文档
- **预览文档**：点击文档信息区域查看文档详情
- **删除文档**：点击删除按钮移除文档
- **重试上传**：上传失败的文档可以点击重试按钮
- **调整顺序**：拖拽文档项的手柄来调整顺序

### 3. 监控上传状态
- 查看进度条了解上传进度
- 观察状态指示器了解文档状态
- 注意错误提示并采取相应措施

## 技术实现

### 核心函数

#### `onBatchUpload()`
- 打开批量上传面板
- 检查用户权限（仅管理员可用）

#### `onSelectBatchFiles()`
- 处理文档选择逻辑
- 验证文档类型和大小
- 初始化文档对象

#### `startBatchUpload()`
- 批量上传文档
- 管理上传状态和进度
- 处理上传成功和失败

#### `updateFileUploadStatus(fileId, status, progress, error)`
- 更新单个文档的上传状态
- 管理进度和错误信息

### 数据结构

```javascript
{
  id: 'unique_file_id',
  name: '文档名称.pdf',
  size: 1024000,
  sizeText: '1.0MB',
  path: 'temp_file_path',
  type: 'application/pdf',
  extension: 'pdf',
  status: 'success', // pending, uploading, success, error
  progress: 100,
  error: null
}
```

## 样式定制

### 状态样式
- **等待上传**：默认样式
- **上传中**：蓝色进度条
- **上传完成**：绿色状态文字
- **上传失败**：红色状态文字

### 响应式设计
- 支持不同屏幕尺寸
- 移动端优化的拖拽体验
- 自适应的文档列表布局

## 注意事项

1. **权限控制**：只有管理员用户可以使用批量上传功能
2. **文件大小限制**：注意微信小程序的单文件上传限制
3. **网络环境**：上传速度受网络环境影响
4. **存储空间**：注意临时文件的存储空间管理

## 与表单文件上传的区别

| 特性 | 文档批量上传 | 表单文件上传 |
|------|-------------|-------------|
| 用途 | 文档管理系统的批量文档上传 | 表单填写时的文件附件上传 |
| 用户权限 | 仅管理员可用 | 所有用户可用 |
| 文件数量 | 最多20个 | 最多10个 |
| 文件类型 | 办公文档、图片等 | 根据表单字段配置 |
| 上传方式 | 批量选择，批量上传 | 逐个选择，即时上传 |
| 存储位置 | 文档库 | 表单提交记录 |

## 未来扩展

1. **云存储集成**：集成腾讯云COS等云存储服务
2. **断点续传**：支持大文档的断点续传功能
3. **批量下载**：支持已上传文档的批量下载
4. **文档压缩**：自动压缩图片等文档以节省空间
5. **OCR识别**：支持文档内容的OCR识别
6. **版本管理**：支持文档版本控制和历史记录

## 更新日志

### v1.0.0 (当前版本)
- ✅ 基础批量上传功能
- ✅ 文档类型和大小验证
- ✅ 上传进度显示
- ✅ 文档预览功能
- ✅ 拖拽排序功能
- ✅ 错误处理和重试机制
- ✅ 响应式UI设计
- ✅ 管理员权限控制
- ✅ 24小时制时间显示
- ✅ 中文时间格式

---

如有问题或建议，请联系开发团队。

# 云函数部署说明

## 问题描述

当前遇到数据库集合不存在的错误：
```
collection.get:fail -502005 database collection not exists
```

## 解决步骤

### 1. 确保云函数已正确部署

1. 在微信开发者工具中，右键点击 `cloudfunctions/quickstartFunctions` 文件夹
2. 选择 "上传并部署：云端安装依赖"
3. 等待部署完成

### 2. 检查云开发环境配置

确保小程序端的云开发环境ID与云函数中的一致：
- 小程序端：`cloud1-6g1pgt8pc50014d6`
- 云函数端：`cloud1-6g1pgt8pc50014d6`

### 3. 测试云函数

1. 在小程序中点击 "测试" 按钮
2. 查看控制台输出，确认云函数是否正常调用
3. 检查数据库连接测试是否成功

### 4. 手动初始化数据库

如果自动初始化失败，可以手动在云开发控制台中创建以下集合：
- `collaborative_forms` - 协作表单集合
- `form_distributions` - 表单分发集合  
- `form_submissions` - 表单提交集合
- `users` - 用户集合

### 5. 常见问题排查

#### 问题1：云函数调用失败
- 检查云函数是否已部署
- 检查网络连接
- 查看云函数日志

#### 问题2：数据库权限问题
- 检查云开发控制台中的数据库权限设置
- 确保云函数有读写权限

#### 问题3：环境ID不匹配
- 确认小程序和云函数使用相同的环境ID
- 检查 `app.js` 和云函数中的环境配置

## 调试信息

云函数现在包含详细的日志输出，可以在云开发控制台的云函数日志中查看：
- 数据库环境信息
- 集合创建过程
- 错误详情和堆栈信息

## 测试流程

1. 部署云函数
2. 在小程序中点击 "测试" 按钮
3. 查看控制台输出
4. 如果测试成功，系统会自动初始化
5. 如果失败，根据错误信息进行排查

## 联系支持

如果问题仍然存在，请：
1. 查看云函数日志
2. 检查云开发控制台状态
3. 联系腾讯云技术支持

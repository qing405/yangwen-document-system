<!--pages/records/records.wxml-->
<view class="container">
  <!-- ç­›é€‰æ  -->
  <view class="filter-section">
    <view class="filter-row">
      <picker 
        mode="selector" 
        range="{{recordTypes}}" 
        range-key="label"
        value="{{selectedType}}"
        bindchange="onTypeChange"
      >
        <view class="filter-item">
          <text>{{selectedType || 'å…¨éƒ¨ç±»å‹'}}</text>
          <text class="picker-arrow">â–¼</text>
        </view>
      </picker>
      
      <picker 
        wx:if="{{userRole === 'admin'}}"
        mode="selector" 
        range="{{workshops}}" 
        range-key="name"
        value="{{selectedWorkshop}}"
        bindchange="onWorkshopChange"
      >
        <view class="filter-item">
          <text>{{selectedWorkshop || 'å…¨éƒ¨è½¦é—´'}}</text>
          <text class="picker-arrow">â–¼</text>
        </view>
      </picker>
      
      <picker 
        mode="selector" 
        range="{{recordStatus}}" 
        range-key="label"
        value="{{selectedStatus}}"
        bindchange="onStatusChange"
      >
        <view class="filter-item">
          <text>{{selectedStatus || 'å…¨éƒ¨çŠ¶æ€'}}</text>
          <text class="picker-arrow">â–¼</text>
        </view>
      </picker>
    </view>
  </view>

  <!-- æ“ä½œæŒ‰é’® -->
  <view class="action-section">
    <button 
      wx:if="{{canCreate}}"
      class="btn btn-primary" 
      bindtap="onCreateRecord"
    >
      ğŸ“ åˆ›å»ºå°è´¦
    </button>
  </view>

  <!-- å°è´¦åˆ—è¡¨ -->
  <view class="records-list">
    <view wx:if="{{records.length === 0 && !loading}}" class="empty-state">
      <view class="empty-icon">ğŸ“‹</view>
      <view class="empty-text">æš‚æ— å°è´¦è®°å½•</view>
    </view>
    
    <view wx:else>
      <view 
        class="record-item list-item" 
        wx:for="{{records}}" 
        wx:key="_id"
        bindtap="onRecordTap"
        data-id="{{item._id}}"
      >
        <view class="list-item-content">
          <view class="list-item-title">{{item.title}}</view>
          <view class="list-item-desc">
            <text class="tag tag-primary">{{item.type}}</text>
            <text class="tag tag-workshop">{{item.workshopName}}</text>
            <text class="text-muted">{{item.created_at}}</text>
          </view>
          <view class="list-item-meta">
            <text class="text-muted">åˆ›å»ºäººï¼š{{item.creatorName}}</text>
            <text class="status-tag status-{{item.status}}">
              {{item.status === 'pending' ? 'å¾…å®¡æ‰¹' : 
                item.status === 'approved' ? 'å·²é€šè¿‡' : 'å·²æ‹’ç»'}}
            </text>
          </view>
        </view>
        
        <view class="list-item-actions">
          <!-- å®¡æ‰¹æŒ‰é’® -->
          <view 
            wx:if="{{canApprove && item.status === 'pending'}}"
            class="action-btn action-approve" 
            bindtap="onApproveRecord" 
            data-id="{{item._id}}" 
            data-status="approved"
          >
            <text class="action-icon">âœ…</text>
          </view>
          <view 
            wx:if="{{canApprove && item.status === 'pending'}}"
            class="action-btn action-reject" 
            bindtap="onApproveRecord" 
            data-id="{{item._id}}" 
            data-status="rejected"
          >
            <text class="action-icon">âŒ</text>
          </view>
          
          <!-- åˆ é™¤æŒ‰é’® -->
          <view 
            wx:if="{{canDelete}}"
            class="action-btn action-delete" 
            bindtap="onDeleteRecord" 
            data-id="{{item._id}}"
          >
            <text class="action-icon">ğŸ—‘ï¸</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- åŠ è½½æ›´å¤š -->
  <view wx:if="{{loading}}" class="loading">
    <text>åŠ è½½ä¸­...</text>
  </view>
  
  <view wx:if="{{!hasMore && records.length > 0}}" class="no-more">
    <text>æ²¡æœ‰æ›´å¤šäº†</text>
  </view>
</view>
